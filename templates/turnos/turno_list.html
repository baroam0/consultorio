
{% extends 'base.html' %}

{% block content %}
    <div class="container">

        <form action="/turnolistado" method="GET">
            <div class="form-inline">
                <div class="col-4">
                </div>
                <div class="col-4">
                    <select class='form-control' id='select_profesional_busqueda' name='select_profesional_busqueda'>
                        <option value=0> Todos</option>
                        {% for profesional in profesionales %}
                            <option value={{profesional.pk}}>
                                {{profesional.usuario.last_name}}, {{profesional.usuario.first_name}}
                            </option>
                            
                        {% endfor%}
                    </select>
                </div>
                <div class="col-4">
                    <!--input class="form-control" id="txtBuscar" name="txtBuscar" placeholder="Buscar...."-->
                    
                    <button type="submit" class="btn btn-default" title="Buscar!">
                        <i class="fas fa-search"></i>
                    </button>

                    &nbsp;
                    &nbsp;
                    &nbsp;

                    <!--button type="button" data-toggle="modal" data-target="#modal-turno" class="btn btn-default"-->
                    <button type="button" onclick="NuevoTurno()" class="btn btn-default">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
        </form>



        <div class="modal fade" id="modal-turno">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">Nuevo Turno  <label id="lbl_profesional"></label></h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">

                    <form id="form-modalturno">

                        
                            <label for="id_numeroafiliado">Paciente:</label>

                            <select id="modal-select-paciente">
                                {% for paciente in pacientes %}
                                    <option value={{paciente.pk}}>
                                        {{paciente}}
                                    </option>
                                {% endfor %}
                            </select>
                        

                        
                            <div class="form-group">
                                <label>Fecha:</label>
                                  <div class="input-group date" id="reservationdate" data-target-input="nearest">
                                      <input id="txt_fecha" type="text" class="form-control datetimepicker-input" data-target="#reservationdate"/>
                                      <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                                          <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                      </div>
                                  </div>
                              </div>
                            <div class="form-group">
                                <label>Hora:</label>
        
                                <div class="input-group date" id="timepicker" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#timepicker"/>
                                    <div class="input-group-append" data-target="#timepicker" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="far fa-clock"></i></div>
                                    </div>
                                </div>
                            </div>
                        
                            <label for="id_numeroafiliado">Obra Social:</label>
                            <select id="modal-select-paciente">
                                {% for obrasocial in obrassociales %}
                                    <option value={{obrasocial.pk}}>
                                        {{obrasocial.abreviatura.upper}}
                                    </option>
                                {% endfor %}
                            </select>

                            <label>Asistio:</label>
                            <label>Entrega:</label>
                            <label>Entrega Parcial:</label>

                            <label for="modal-observacion">Observacion:</label>
                            <textarea id="modal-observacion"></textarea>                        

                    </form>

                </div>
                <div class="modal-footer justify-content-between">
                    
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        <i class="fas fa-times-circle"></i>
                        Cerrar
                    </button>
                    
                    <button type="button" class="btn btn-primary" onclick="javascrit:GrabarTurno()">
                        <i class="fas fa-save"></i> 
                        Guardar
                    </button>
                </div>
              </div>
              <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

    </div>

    <div id="calendar"></div>
{% endblock %}


{% block js_extra %}
    <script>
        

        $(document).ready(function () {
            var parametroselect = "";
            parametroselect = ObtenerParametroURL();

            if(parametroselect==null){
            }else{
                $('#select_profesional_busqueda').val(parametroselect);
            }


            $('#reservationdate').datetimepicker({
                format: 'L',
                locale: 'es'
            });


            $('#timepicker').datetimepicker({
                format: 'LT',
                locale: 'es'
            })


            $("#modal-select-paciente").select2();
            var Calendar = FullCalendar.Calendar;
            var calendarEl = document.getElementById('calendar');    

            var calendar = new Calendar(calendarEl, {
                locales: 'es',
                plugins: [ 'bootstrap', 'interaction', 'dayGrid', 'timeGrid' ],
                buttonText: {
                    today: 'hoy',
                },
                events: [
                    {% for r in resultados %}
                        {
                            id: '{{r.pk}}',
                            title: '{{r.paciente}}',
                            start: '{{r.fechahora.isoformat}}'
                        },
                    {% endfor %}
                ],  

                eventClick: function(info) {
                    var eventObj = info.event;
                    console.log(eventObj);
                    alert(eventObj.title);
                },
            })
            calendar.render();
        });


        function GrabarTurno(){
            var paciente_id = $("#modal-select-paciente").val();
            //var fecha = $("#reservationdate").data("datetimepicker").getDate();
            //var fecha = $("#reservationdate").text();
            var fecha = $("#reservationdate").find("input").val();
            var hora = $("#timepicker").find("input").val();

            console.log(hora);
            //modal-select-paciente
            //$('#reservationdate')
            //reservationdate
            //timepicker
        }


        function ModificarTurno(id){
            $("#modal-turno").modal();
        }


        function NuevoTurno(){
            if($("#select_profesional_busqueda").val()==0){
                alert("Por favor elija un profesional")
            }else{
                var profesional = $('#select_profesional_busqueda').find(':selected');
                $('#lbl_profesional').text(profesional.text());
                $("#modal-turno").modal();
            }
        }


        function ObtenerParametroURL(){
            var queryString = window.location.search;
            var urlParams = new URLSearchParams(queryString);
            var parametroprofesional = urlParams.get('select_profesional_busqueda');
            return parametroprofesional;
            
        }

        

    </script>

    
{% endblock %}